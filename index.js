require('dotenv').config();
const { Client, GatewayIntentBits } = require('discord.js');

const client = new Client({
  intents: [
    GatewayIntentBits.Guilds,
    GatewayIntentBits.GuildVoiceStates,
    GatewayIntentBits.GuildMessages,
    GatewayIntentBits.MessageContent,
  ],
});

client.once('ready', () => {
  console.log(`‚úÖ Logged in as ${client.user.tag}`);
});

client.on('messageCreate', async (message) => {
  if (message.author.bot) return;

  // ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á !poke @user [‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°]
  if (message.content.startsWith('!poke')) {
    const args = message.content.split(' ');
    const member = message.mentions.members.first();
    if (!member) return message.reply('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ mention ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÄ‡∏ä‡πà‡∏ô `!poke @user [‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°]`');
    
    const pokeMessage = args.slice(2).join(' ') || '‡πÇ‡∏õ‡πä‡∏Å!!!'; // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÑ‡∏õ

    const voiceChannel = member.voice.channel;
    if (!voiceChannel) return message.reply('‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Voice Channel');
    
    const afkChannel = message.guild.afkChannel;
    if (!afkChannel) return message.reply('‡πÑ‡∏°‡πà‡∏û‡∏ö AFK channel ‡πÉ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ');

    try {
      // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á DM
      await member.send(`${pokeMessage}`);
      
      // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏ä‡∏ó
      message.channel.send(`${member}, ${pokeMessage}`);

      // ‡∏™‡∏•‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏õ AFK
      await member.voice.setChannel(afkChannel);

      // ‡∏™‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (Ping)
      member.send('üîî Poke Alert! üîî');
      
      // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ GIF ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
      message.channel.send({ 
        content: `${member} ‡πÇ‡∏î‡∏ô poke!`, 
        files: ['https://media.giphy.com/media/l41Yq4Tnlg1B0uMnO/giphy.gif'] // ‡πÉ‡∏™‡πà GIF ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
      });

      // ‡∏£‡∏≠ 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°
      setTimeout(async () => {
        await member.voice.setChannel(voiceChannel);
        message.reply(`‚úÖ Poke ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ${member.user.username} ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°`);
      }, 2000);

    } catch (err) {
      console.error(err);
      message.reply('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
    }
  }
});

client.login(process.env.DISCORD_TOKEN);
